!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TormakTweakpaneGradientPlugin={})}(this,(function(t){"use strict";function e(t){return null==t}class s{constructor(){this.observers_={}}on(t,e){let s=this.observers_[t];return s||(s=this.observers_[t]=[]),s.push({handler:e}),this}off(t,e){const s=this.observers_[t];return s&&(this.observers_[t]=s.filter((t=>t.handler!==e))),this}emit(t,e){const s=this.observers_[t];s&&s.forEach((t=>{t.handler(e)}))}}const i="tp";function n(t){return(e,s)=>[i,"-",t,"v",e?`_${e}`:"",s?`-${s}`:""].join("")}function o(t){return t.rawValue}function r(t,e){var s,i;t.emitter.on("change",(s=o,i=e,t=>i(s(t)))),e(t.rawValue)}function a(t,e,s){r(t.value(e),s)}class l{constructor(t,e){var i;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(i=null==e?void 0:e.equals)&&void 0!==i?i:(t,e)=>t===e,this.emitter=new s,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const s=null!=e?e:{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(t):t,n=this.rawValue_;(!this.equals_(n,i)||s.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:s,previousRawValue:n,rawValue:i,sender:this}))}}class h{constructor(t){this.emitter=new s,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const s=null!=e?e:{forceEmit:!1,last:!0},i=this.value_;(i!==t||s.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:s,previousRawValue:i,rawValue:this.value_,sender:this}))}}function c(t,e){const s=null==e?void 0:e.constraint,i=null==e?void 0:e.equals;return s||i?new l(t,e):new h(t)}class u{constructor(t){this.emitter=new s,this.valMap_=t;for(const t in this.valMap_){this.valMap_[t].emitter.on("change",(()=>{this.emitter.emit("change",{key:t,sender:this})}))}}static createCore(t){return Object.keys(t).reduce(((e,s)=>Object.assign(e,{[s]:c(t[s])})),{})}static fromObject(t){const e=this.createCore(t);return new u(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}function d(t){return e=>s=>{if(!e&&void 0===s)return{succeeded:!1,value:void 0};if(e&&void 0===s)return{succeeded:!0,value:void 0};const i=t(s);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function p(t){return{custom:e=>d(e)(t),boolean:d((t=>"boolean"==typeof t?t:void 0))(t),number:d((t=>"number"==typeof t?t:void 0))(t),string:d((t=>"string"==typeof t?t:void 0))(t),function:d((t=>"function"==typeof t?t:void 0))(t),constant:e=>d((t=>t===e?e:void 0))(t),raw:d((t=>t))(t),object:e=>d((t=>{var s;if(null!==(s=t)&&"object"==typeof s)return function(t,e){return Object.keys(e).reduce(((s,i)=>{if(void 0===s)return;const n=(0,e[i])(t[i]);return n.succeeded?Object.assign(Object.assign({},s),{[i]:n.value}):void 0}),{})}(t,e)}))(t),array:e=>d((t=>{var s;if(Array.isArray(t))return s=e,t.reduce(((t,e)=>{if(void 0===t)return;const i=s(e);return i.succeeded&&void 0!==i.value?[...t,i.value]:void 0}),[])}))(t)}}const v={optional:p(!0),required:p(!1)};const m="http://www.w3.org/2000/svg";const g={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};class w extends u{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},s=u.createCore(e);return new w(s)}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!e(t)?`${t}px`:"auto"}bindExpandedClass(t,e){const s=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};a(this,"expanded",s),a(this,"temporaryExpanded",s)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}class _{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce(((t,e)=>e.constrain(t)),t)}}class f{constructor(t){this.values=u.fromObject({max:t.max,min:t.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(t){const s=this.values.get("max"),i=this.values.get("min");let n=t;return e(i)||(n=Math.max(n,i)),e(s)||(n=Math.min(n,s)),n}}class b{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){const e=this.origin%this.step;return e+Math.round((t-e)/this.step)*this.step}}class x{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const y={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class C{constructor(t,e,s){this.left=e,this.operator=t,this.right=s}evaluate(){const t=y[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const V={"+":t=>t,"-":t=>-t,"~":t=>~t};class E{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=V[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function P(t){return(e,s)=>{for(let i=0;i<t.length;i++){const n=t[i](e,s);if(""!==n)return n}return""}}function S(t,e){var s;const i=t.substr(e).match(/^\s+/);return null!==(s=i&&i[0])&&void 0!==s?s:""}function L(t,e){var s;const i=t.substr(e).match(/^[0-9]+/);return null!==(s=i&&i[0])&&void 0!==s?s:""}function M(t,e){const s=t.substr(e,1);if(e+=1,"e"!==s.toLowerCase())return"";const i=function(t,e){const s=L(t,e);if(""!==s)return s;const i=t.substr(e,1);if("-"!==i&&"+"!==i)return"";const n=L(t,e+=1);return""===n?"":i+n}(t,e);return""===i?"":s+i}function k(t,e){const s=t.substr(e,1);if("0"===s)return s;const i=function(t,e){const s=t.substr(e,1);return s.match(/^[1-9]$/)?s:""}(t,e);return e+=i.length,""===i?"":i+L(t,e)}const I=P([function(t,e){const s=k(t,e);if(e+=s.length,""===s)return"";const i=t.substr(e,1);if(e+=i.length,"."!==i)return"";const n=L(t,e);return s+i+n+M(t,e+=n.length)},function(t,e){const s=t.substr(e,1);if(e+=s.length,"."!==s)return"";const i=L(t,e);return e+=i.length,""===i?"":s+i+M(t,e)},function(t,e){const s=k(t,e);return e+=s.length,""===s?"":s+M(t,e)}]);const T=P([function(t,e){const s=t.substr(e,2);if(e+=s.length,"0b"!==s.toLowerCase())return"";const i=function(t,e){var s;const i=t.substr(e).match(/^[01]+/);return null!==(s=i&&i[0])&&void 0!==s?s:""}(t,e);return""===i?"":s+i},function(t,e){const s=t.substr(e,2);if(e+=s.length,"0o"!==s.toLowerCase())return"";const i=function(t,e){var s;const i=t.substr(e).match(/^[0-7]+/);return null!==(s=i&&i[0])&&void 0!==s?s:""}(t,e);return""===i?"":s+i},function(t,e){const s=t.substr(e,2);if(e+=s.length,"0x"!==s.toLowerCase())return"";const i=function(t,e){var s;const i=t.substr(e).match(/^[0-9a-f]+/i);return null!==(s=i&&i[0])&&void 0!==s?s:""}(t,e);return""===i?"":s+i}]),D=P([T,I]);function K(t,e){var s;return null!==(s=function(t,e){const s=D(t,e);return e+=s.length,""===s?null:{evaluable:new x(s),cursor:e}}(t,e))&&void 0!==s?s:function(t,e){const s=t.substr(e,1);if(e+=s.length,"("!==s)return null;const i=$(t,e);if(!i)return null;e=i.cursor,e+=S(t,e).length;const n=t.substr(e,1);return e+=n.length,")"!==n?null:{evaluable:i.evaluable,cursor:e}}(t,e)}function R(t,e,s){s+=S(e,s).length;const i=t.filter((t=>e.startsWith(t,s)))[0];return i?(s+=i.length,{cursor:s+=S(e,s).length,operator:i}):null}const B=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((t,e)=>function(t,e){return(s,i)=>{const n=t(s,i);if(!n)return null;i=n.cursor;let o=n.evaluable;for(;;){const n=R(e,s,i);if(!n)break;i=n.cursor;const r=t(s,i);if(!r)return null;i=r.cursor,o=new C(n.operator,o,r.evaluable)}return o?{cursor:i,evaluable:o}:null}}(t,e)),(function t(e,s){const i=K(e,s);if(i)return i;const n=e.substr(s,1);if(s+=n.length,"+"!==n&&"-"!==n&&"~"!==n)return null;const o=t(e,s);return o?{cursor:s=o.cursor,evaluable:new E(n,o.evaluable)}:null}));function $(t,e){return e+=S(t,e).length,B(t,e)}function j(t){var e;const s=function(t){const e=$(t,0);return e?e.cursor+S(t,e.cursor).length!==t.length?null:e.evaluable:null}(t);return null!==(e=null==s?void 0:s.evaluate())&&void 0!==e?e:null}function U(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}U(0);function H({primary:t,secondary:e,forward:s,backward:i}){let n=!1;function o(t){n||(n=!0,t(),n=!1)}t.emitter.on("change",(i=>{o((()=>{e.setRawValue(s(t,e),i.options)}))})),e.emitter.on("change",(n=>{o((()=>{t.setRawValue(i(t,e),n.options)})),o((()=>{e.setRawValue(s(t,e),n.options)}))})),o((()=>{e.setRawValue(s(t,e),{forceEmit:!1,last:!0})}))}function O(t,e){const s=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+s:e.downKey?-s:0}function A(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function F(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function G(t,e){var s,i;const n=e.ownerDocument.defaultView,o=e.getBoundingClientRect();return{x:t.pageX-((null!==(s=n&&n.scrollX)&&void 0!==s?s:0)+o.left),y:t.pageY-((null!==(i=n&&n.scrollY)&&void 0!==i?i:0)+o.top)}}class N{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new s,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const s=this.elem_.ownerDocument;s.addEventListener("mousemove",this.onDocumentMouseMove_),s.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(G(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(G(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(G(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-s.left,y:e.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-s.left,y:e.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const s=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(s?{x:s.clientX-i.left,y:s.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey})}}function X(t,e,s,i,n){return i+(t-e)/(s-e)*(n-i)}function q(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function z(t,e,s){return Math.min(Math.max(t,e),s)}function Y(t,e){return(t%e+e)%e}const W=n("txt");class J{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(W(),W(void 0,"num")),e.arrayPosition&&this.element.classList.add(W(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const s=t.createElement("input");s.classList.add(W("i")),s.type="text",e.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(W()),this.inputElement.classList.add(W("i"));const i=t.createElement("div");i.classList.add(W("k")),this.element.appendChild(i),this.knobElement=i;const o=t.createElementNS(m,"svg");o.classList.add(W("g")),this.knobElement.appendChild(o);const r=t.createElementNS(m,"path");r.classList.add(W("gb")),o.appendChild(r),this.guideBodyElem_=r;const a=t.createElementNS(m,"path");a.classList.add(W("gh")),o.appendChild(a),this.guideHeadElem_=a;const l=t.createElement("div");l.classList.add(n("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(null===t.rawValue)return void this.element.classList.remove(W(void 0,"drg"));this.element.classList.add(W(void 0,"drg"));const e=t.rawValue/this.props_.get("draggingScale"),s=e+(e>0?-1:e<0?1:0),i=z(-s,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${s+i},0 L${s},4 L${s+i},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const n=this.props_.get("formatter");this.tooltipElem_.textContent=n(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class Q{constructor(t,e){var s;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.parser_=e.parser,this.props=e.props,this.sliderProps_=null!==(s=e.sliderProps)&&void 0!==s?s:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=c(null),this.view=new J(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const i=new N(this.view.knobElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,s;const i=null===(e=this.sliderProps_)||void 0===e?void 0:e.get("minValue"),n=null===(s=this.sliderProps_)||void 0===s?void 0:s.get("maxValue");let o=t;return void 0!==i&&(o=Math.max(o,i)),void 0!==n&&(o=Math.min(o,n)),o}onInputChange_(t){const s=t.currentTarget.value,i=this.parser_(s);e(i)||(this.value.rawValue=this.constrainValue_(i)),this.view.refresh()}onInputKeyDown_(t){const e=O(this.baseStep_,A(t));0!==e&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==O(this.baseStep_,A(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("draggingScale"))}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}function Z(t,e){const s=t&&function(t,e){if(t instanceof e)return t;if(t instanceof _){const s=t.constraints.reduce(((t,s)=>t||(s instanceof e?s:null)),null);if(s)return s}return null}(t,b);return s?q(s.step):Math.max(q(e),2)}function tt(t){return[t[0],t[1],t[2]]}const et={hsl:{hsl:(t,e,s)=>[t,e,s],hsv:function(t,e,s){const i=s+e*(100-Math.abs(2*s-100))/200;return[t,0!==i?e*(100-Math.abs(2*s-100))/i:0,s+e*(100-Math.abs(2*s-100))/200]},rgb:function(t,e,s){const i=(t%360+360)%360,n=z(e/100,0,1),o=z(s/100,0,1),r=(1-Math.abs(2*o-1))*n,a=r*(1-Math.abs(i/60%2-1)),l=o-r/2;let h,c,u;return[h,c,u]=i>=0&&i<60?[r,a,0]:i>=60&&i<120?[a,r,0]:i>=120&&i<180?[0,r,a]:i>=180&&i<240?[0,a,r]:i>=240&&i<300?[a,0,r]:[r,0,a],[255*(h+l),255*(c+l),255*(u+l)]}},hsv:{hsl:function(t,e,s){const i=100-Math.abs(s*(200-e)/100-100);return[t,0!==i?e*s/i:0,s*(200-e)/200]},hsv:(t,e,s)=>[t,e,s],rgb:function(t,e,s){const i=Y(t,360),n=z(e/100,0,1),o=z(s/100,0,1),r=o*n,a=r*(1-Math.abs(i/60%2-1)),l=o-r;let h,c,u;return[h,c,u]=i>=0&&i<60?[r,a,0]:i>=60&&i<120?[a,r,0]:i>=120&&i<180?[0,r,a]:i>=180&&i<240?[0,a,r]:i>=240&&i<300?[a,0,r]:[r,0,a],[255*(h+l),255*(c+l),255*(u+l)]}},rgb:{hsl:function(t,e,s){const i=z(t/255,0,1),n=z(e/255,0,1),o=z(s/255,0,1),r=Math.max(i,n,o),a=Math.min(i,n,o),l=r-a;let h=0,c=0;const u=(a+r)/2;return 0!==l&&(c=l/(1-Math.abs(r+a-1)),h=i===r?(n-o)/l:n===r?2+(o-i)/l:4+(i-n)/l,h=h/6+(h<0?1:0)),[360*h,100*c,100*u]},hsv:function(t,e,s){const i=z(t/255,0,1),n=z(e/255,0,1),o=z(s/255,0,1),r=Math.max(i,n,o),a=r-Math.min(i,n,o);let l;return l=0===a?0:r===i?((n-o)/a%6+6)%6*60:r===n?60*((o-i)/a+2):60*((i-n)/a+4),[l,100*(0===r?0:a/r),100*r]},rgb:(t,e,s)=>[t,e,s]}};function st(t,e){return["float"===e?1:"rgb"===t?255:360,"float"===e?1:"rgb"===t?255:100,"float"===e?1:"rgb"===t?255:100]}function it(t,e,s,i){const n=st(e,s),o=st(e,i);return t.map(((t,e)=>t/n[e]*o[e]))}function nt(t,s){return"object"==typeof t&&!e(t)&&(s in t&&"number"==typeof t[s])}class ot{static black(t="int"){return new ot([0,0,0],"rgb",t)}static fromObject(t,e="int"){const s="a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b];return new ot(s,"rgb",e)}static toRgbaObject(t,e="int"){return t.toRgbaObject(e)}static isRgbColorObject(t){return nt(t,"r")&&nt(t,"g")&&nt(t,"b")}static isRgbaColorObject(t){return this.isRgbColorObject(t)&&nt(t,"a")}static isColorObject(t){return this.isRgbColorObject(t)}static equals(t,e){if(t.mode!==e.mode)return!1;const s=t.comps_,i=e.comps_;for(let t=0;t<s.length;t++)if(s[t]!==i[t])return!1;return!0}constructor(t,e,s="int"){this.mode=e,this.type=s,this.comps_=function(t,e,s){var i;const n=st(e,s);return["rgb"===e?z(t[0],0,n[0]):(o=t[0],r=n[0],o===r?r:Y(o,r)),z(t[1],0,n[1]),z(t[2],0,n[2]),z(null!==(i=t[3])&&void 0!==i?i:1,0,1)];var o,r}(t,e,s)}getComponents(t,e="int"){return s=function(t,e,s){const i=it(t,e.mode,e.type,"int");return it(et[e.mode][s.mode](...i),s.mode,"int",s.type)}(tt(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:e}),i=this.comps_[3],[s[0],s[1],s[2],i];var s,i}toRgbaObject(t="int"){const e=this.getComponents("rgb",t);return{r:e[0],g:e[1],b:e[2],a:e[3]}}}function rt(t,e){const s=U("float"===e?2:0);return`rgb(${tt(t.getComponents("rgb",e)).map((t=>s(t))).join(", ")})`}function at(t){return e=>rt(e,t)}function lt(t){return e=>function(t,e){const s=U(2),i=U("float"===e?2:0);return`rgba(${t.getComponents("rgb",e).map(((t,e)=>(3===e?s:i)(t))).join(", ")})`}(e,t)}function ht(t){return e=>function(t,e){const s=U("float"===e?2:0),i=["r","g","b"];return`{${tt(t.getComponents("rgb",e)).map(((t,e)=>`${i[e]}: ${s(t)}`)).join(", ")}}`}(e,t)}function ct(t){return e=>function(t,e){const s=U(2),i=U("float"===e?2:0),n=["r","g","b","a"];return`{${t.getComponents("rgb",e).map(((t,e)=>`${n[e]}: ${(3===e?s:i)(t)}`)).join(", ")}}`}(e,t)}["int","float"].reduce(((t,e)=>[...t,{format:{alpha:!1,mode:"rgb",notation:"func",type:e},stringifier:at(e)},{format:{alpha:!0,mode:"rgb",notation:"func",type:e},stringifier:lt(e)},{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:ht(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:ct(e)}]),[]);const ut=n("colp");class dt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ut());const s=t.createElement("div");s.classList.add(ut("hsv"));const i=t.createElement("div");i.classList.add(ut("sv")),this.svPaletteView_=e.svPaletteView,i.appendChild(this.svPaletteView_.element),s.appendChild(i);const n=t.createElement("div");n.classList.add(ut("h")),this.hPaletteView_=e.hPaletteView,n.appendChild(this.hPaletteView_.element),s.appendChild(n),this.element.appendChild(s);const o=t.createElement("div");o.classList.add(ut("rgb")),this.textView_=e.textView,o.appendChild(this.textView_.element),this.element.appendChild(o)}get allFocusableElements(){return[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map((t=>t.inputElement))]}}const pt=n("coltxt");class vt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(pt());const s=t.createElement("div");s.classList.add(pt("m")),this.modeElem_=function(t){const e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce(((e,s)=>{const i=t.createElement("option");return i.textContent=s.text,i.value=s.value,e.appendChild(i),e}),t.createDocumentFragment())),e}(t),this.modeElem_.classList.add(pt("ms")),s.appendChild(this.modeSelectElement);const i=t.createElement("div");i.classList.add(pt("mm")),i.appendChild(function(t,e){const s=t.createElementNS(m,"svg");return s.innerHTML=g[e],s}(t,"dropdown")),s.appendChild(i),this.element.appendChild(s);const n=t.createElement("div");n.classList.add(pt("w")),this.element.appendChild(n),this.textsElem_=n,this.textViews_=e.textViews,this.applyTextViews_(),r(e.colorMode,(t=>{this.modeElem_.value=t}))}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(t){this.textViews_=t,this.applyTextViews_()}applyTextViews_(){!function(t){for(;t.children.length>0;)t.removeChild(t.children[0])}(this.textsElem_);const t=this.element.ownerDocument;this.textViews_.forEach((e=>{const s=t.createElement("div");s.classList.add(pt("c")),s.appendChild(e.element),this.textsElem_.appendChild(s)}))}}function mt(t,e,s){const i=Y(t,360),n=z(e/100,0,1),o=z(s/100,0,1),r=o*n,a=r*(1-Math.abs(i/60%2-1)),l=o-r;let h,c,u;return[h,c,u]=i>=0&&i<60?[r,a,0]:i>=60&&i<120?[a,r,0]:i>=120&&i<180?[0,r,a]:i>=180&&i<240?[0,a,r]:i>=240&&i<300?[a,0,r]:[r,0,a],[255*(h+l),255*(c+l),255*(u+l)]}function gt(t){return t?.1:1}function wt(t,e,s){const i=function(t,e){return["float"===e?1:"rgb"===t?255:360,"float"===e?1:"rgb"===t?255:100,"float"===e?1:"rgb"===t?255:100]}(t,e)[s];return new f({min:0,max:i})}function _t(t,e,s){return new Q(t,{arrayPosition:0===s?"fst":2===s?"lst":"mid",baseStep:gt(!1),parser:e.parser,props:u.fromObject({draggingScale:"float"===e.colorType?.01:1,formatter:(i=e.colorType,U("float"===i?2:0))}),value:c(0,{constraint:wt(e.colorMode,e.colorType,s)}),viewProps:e.viewProps});var i}class ft{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.parser_=e.parser,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=c(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new vt(t,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},s=[_t(t,e,0),_t(t,e,1),_t(t,e,2)];return s.forEach(((t,e)=>{H({primary:this.value,secondary:t.value,forward:t=>t.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[e],backward:(t,s)=>{const i=this.colorMode.rawValue,n=t.rawValue.getComponents(i,this.colorType_);return n[e]=s.rawValue,new ot(function(t,e){return[t[0],t[1],t[2],e]}(function(t){return[t[0],t[1],t[2]]}(n),n[3]),i,this.colorType_)}})})),s}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const bt=n("hpl");class xt{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(bt()),e.viewProps.bindTabIndex(this.element);const s=t.createElement("div");s.classList.add(bt("c")),this.element.appendChild(s);const i=t.createElement("div");i.classList.add(bt("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=rt(new ot([e,100,100],"hsv"));const s=X(e,0,360,0,100);this.markerElem_.style.left=`${s}%`}onValueChange_(){this.update_()}}class yt{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new xt(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new N(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const s=X(z(t.point.x,0,t.bounds.width),0,t.bounds.width,0,359),i=this.value.rawValue,[,n,o,r]=i.getComponents("hsv");this.value.setRawValue(new ot([s,n,o,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=O(gt(!1),F(t));if(0===e)return;const s=this.value.rawValue,[i,n,o,r]=s.getComponents("hsv");this.value.setRawValue(new ot([i+e,n,o,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==O(gt(!1),F(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ct=n("svp");class Vt{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Ct()),e.viewProps.bindTabIndex(this.element);const s=t.createElement("canvas");s.height=64,s.width=64,s.classList.add(Ct("c")),this.element.appendChild(s),this.canvasElement=s;const i=t.createElement("div");i.classList.add(Ct("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const t=function(t){const e=t.ownerDocument.defaultView;return e&&"document"in e?t.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!t)return;const e=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,i=this.canvasElement.height,n=t.getImageData(0,0,s,i),o=n.data;for(let t=0;t<i;t++)for(let n=0;n<s;n++){const r=X(n,0,s,0,100),a=X(t,0,i,100,0),l=mt(e[0],r,a),h=4*(t*s+n);o[h]=l[0],o[h+1]=l[1],o[h+2]=l[2],o[h+3]=255}t.putImageData(n,0,0);const r=X(e[1],0,100,0,100);this.markerElem_.style.left=`${r}%`;const a=X(e[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class Et{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Vt(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new N(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const s=X(t.point.x,0,t.bounds.width,0,100),i=X(t.point.y,0,t.bounds.height,100,0),[n,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ot([n,s,i,o],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){var e;(function(t){return"ArrowUp"===t||"ArrowDown"===t}(e=t.key)||"ArrowLeft"===e||"ArrowRight"===e)&&t.preventDefault();const[s,i,n,o]=this.value.rawValue.getComponents("hsv"),r=gt(!1),a=O(r,F(t)),l=O(r,A(t));0===a&&0===l||this.value.setRawValue(new ot([s,i+a,n+l,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=gt(!1),s=O(e,F(t)),i=O(e,A(t));0===s&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Pt{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new yt(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Et(t,{value:this.value,viewProps:this.viewProps}),this.textC_=new ft(t,{colorType:e.colorType,parser:j,value:this.value,viewProps:this.viewProps}),this.view=new dt(t,{hPaletteView:this.hPaletteC_.view,supportsAlpha:!1,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const St=n("pop_custom");class Lt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(St()),e.viewProps.bindClassModifiers(this.element),r(e.shows,function(t,e){return s=>{!function(t,e,s){s?t.classList.add(e):t.classList.remove(e)}(t,e,s)}}(this.element,St(void 0,"v")))}}class Mt{constructor(t,e){this.shows=c(!1),console.log(this.shows),this.viewProps=e.viewProps,this.view=new Lt(t,{shows:this.shows,viewProps:this.viewProps})}}function kt(t){const e=t.map((t=>{const e=(t=Math.round(t)).toString(16);return 1==e.length?`0${e}`:e}));return`#${e[0]}${e[1]}${e[2]}`}const It=n("gradient"),Tt=150;class Dt{constructor(t,e){this.stopIdx=c(0),this.movingStop=!1,this._cnvsStopsArr=[],this.element=t.createElement("div"),this.element.classList.add(It()),e.viewProps.bindClassModifiers(this.element),this._value=e.value,this.colBtnCol=c(e.colBtnCol),this.curStopPos=e.curStopPos,this._value.emitter.on("change",this._onValueChange.bind(this)),this.stopIdx.emitter.on("change",this._onValueChange.bind(this));{const e=t.createElement("div");e.classList.add(It("ar_cont")),this.addStop=t.createElement("div"),this.addStop.classList.add(It("edit_stops")),this.addStop.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M432 256c0 17.69-14.33 32.01-32 32.01H256v144c0 17.69-14.33 31.99-32 31.99s-32-14.3-32-31.99v-144H48c-17.67 0-32-14.32-32-32.01s14.33-31.99 32-31.99H192v-144c0-17.69 14.33-32.01 32-32.01s32 14.32 32 32.01v144h144C417.7 224 432 238.3 432 256z"/></svg>',e.appendChild(this.addStop),this.removeStop=t.createElement("div"),this.removeStop.classList.add(It("edit_stops")),this.removeStop.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M400 288h-352c-17.69 0-32-14.32-32-32.01s14.31-31.99 32-31.99h352c17.69 0 32 14.3 32 31.99S417.7 288 400 288z"/></svg>',e.appendChild(this.removeStop),this.element.appendChild(e)}const s=t.createElement("div");s.classList.add(It("canvas_cont")),this._canvas=t.createElement("canvas"),this._canvas.height=20,this._canvas.width=Tt,this._canvas.classList.add(It("canvas")),s.appendChild(this._canvas),this.element.appendChild(s);{const e=t.createElement("div");e.classList.add(It("ctrl_cont")),this._cycleIdx=t.createElement("div"),this._cycleIdx.classList.add(It("cycle_idx")),this.nCycleIdx=t.createElement("div"),this.nCycleIdx.classList.add(It("cycle_idx_btn")),this.nCycleIdx.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512">\x3c!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M137.4 406.6l-128-127.1C3.125 272.4 0 264.2 0 255.1s3.125-16.38 9.375-22.63l128-127.1c9.156-9.156 22.91-11.9 34.88-6.943S192 115.1 192 128v255.1c0 12.94-7.781 24.62-19.75 29.58S146.5 415.8 137.4 406.6z"/></svg>',this._cycleIdx.appendChild(this.nCycleIdx),this._idxDisp=t.createElement("div"),this._idxDisp.classList.add(It("cycle_idx_disp")),this._idxDisp.innerText=this.stopIdx.rawValue.toString(),this._cycleIdx.appendChild(this._idxDisp),this.pCycleIdx=t.createElement("div"),this.pCycleIdx.classList.add(It("cycle_idx_btn")),this.pCycleIdx.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512">\x3c!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M118.6 105.4l128 127.1C252.9 239.6 256 247.8 256 255.1s-3.125 16.38-9.375 22.63l-128 127.1c-9.156 9.156-22.91 11.9-34.88 6.943S64 396.9 64 383.1V128c0-12.94 7.781-24.62 19.75-29.58S109.5 96.23 118.6 105.4z"/></svg>',this._cycleIdx.appendChild(this.pCycleIdx),e.appendChild(this._cycleIdx),this.setPos=t.createElement("div"),this.setPos.classList.add(It("set_pos"));const s=t.createElement("div");s.innerText="Pos:",s.classList.add(It("set_pos_label")),this.setPos.appendChild(s),e.appendChild(this.setPos),this.element.appendChild(e)}{const e=t.createElement("div");e.classList.add(It("col_cont")),this.colorButton=t.createElement("div"),this.colorButton.classList.add(It("stop_color_view")),e.appendChild(this.colorButton),this.element.appendChild(e)}this._refresh();const i=t=>{if(this.movingStop){const e=Math.floor((t.pageX-this._canvas.getBoundingClientRect().left)/Tt*100)/100;e>=0&&e<=1&&this.curStopPos.setRawValue(e)}};i.bind(this),e.viewProps.handleDispose((()=>{this._value.emitter.off("change",this._onValueChange.bind(this)),t.removeEventListener("mouseup",(()=>{this.movingStop&&(this.movingStop=!1)})),t.removeEventListener("mousemove",i)})),t.addEventListener("mouseup",(()=>{this.movingStop&&(this.movingStop=!1)})),t.addEventListener("mousemove",i)}getCanvasTexture(){return this._canvas.getContext("2d").getImageData(0,0,150,20)}getColorAtPoint(t){const e=this._canvas.getContext("2d").getImageData(t*Tt,0,1,1).data;return{r:e[0],g:e[1],b:e[2]}}_refresh(){var t;this._idxDisp.innerText=this.stopIdx.rawValue.toString();const e=this.colBtnCol.rawValue.getComponents(this.colBtnCol.rawValue.mode,"int");this.colorButton.style.backgroundColor=`${"rgb"==this.colBtnCol.rawValue.mode?"rgb":"hsv"==this.colBtnCol.rawValue.mode?"hsv":"hsl"}(${e[0]}, ${e[1]}, ${e[2]})`;const s=this._value.rawValue,i=this._canvas.getContext("2d");i.fillStyle="#000000",i.fillRect(0,0,Tt,20);const n=i.createLinearGradient(0,0,Tt,0);this._cnvsStopsArr.map((t=>{t.remove()})),this._cnvsStopsArr=[];for(let e=0;e<s.stops.length;e++){const i=s.stops[e];n.addColorStop(i.stop,"string"==typeof i.color?i.color:void 0!==i.color.r?`rgb(${i.color.r}, ${i.color.g}, ${i.color.b})`:`hsv(${i.color.h}, ${i.color.s}, ${i.color.v})`);const o=document.createElement("div");o.classList.add(It("canvas_marker")),o.setAttribute("idx",e.toString()),o.style.left=i.stop*Tt-2+"px",o.style.bottom="-8px",o.addEventListener("mousedown",(t=>{this.movingStop=!0,this.stopIdx.setRawValue(parseInt(t.currentTarget.getAttribute("idx")))}));const r=document.createElement("div");r.classList.add(It("marker_top")),o.appendChild(r);const a=document.createElement("div");a.classList.add(It("marker_col_disp")),a.style.backgroundColor=`${"string"==typeof i.color?i.color:void 0!==i.color.r?`rgb(${i.color.r}, ${i.color.g}, ${i.color.b})`:`hsv(${i.color.h}, ${i.color.s}, ${i.color.v})`}`,o.appendChild(a),this._cnvsStopsArr.push(o),null===(t=this._canvas.parentElement)||void 0===t||t.appendChild(o)}i.fillStyle=n,i.fillRect(0,0,Tt,20)}_onValueChange(){this._refresh()}}var Kt;!function(t){t.RGB="rgb",t.HSV="hsv",t.HEX="hex"}(Kt||(Kt={}));class Rt{constructor(t,e){this._stopIdx=c(0),this._curStopPos=c(0),this._curStopCol=c(new ot([0,0,0],"rgb")),this._colorSpace=e.colorSpace,this._onButtonBlur=this._onButtonBlur.bind(this),this._onButtonClick=this._onButtonClick.bind(this),this._onPopupChildBlur=this._onPopupChildBlur.bind(this),this._onPopupChildKeydown=this._onPopupChildKeydown.bind(this),this._cycleStopIdx=this._cycleStopIdx.bind(this),this._addStop=this._addStop.bind(this),this._removeStop=this._removeStop.bind(this),this._setStopPos=this._setStopPos.bind(this),this._setStopColor=this._setStopColor.bind(this),this.value=e.value,this._curStopPos.setRawValue(this.value.rawValue.stops[0].stop),this._curStopCol.setRawValue(this._gradientColToTweakCol(this.value.rawValue.stops[0].color)),this.viewProps=e.viewProps,this._foldable=w.create(!!e.expanded&&e.expanded),this.view=new Dt(t,{value:this.value,curStopPos:this._curStopPos,colBtnCol:this._curStopCol.rawValue,viewProps:this.viewProps}),this.value.setRawValue({stops:this.value.rawValue.stops,getGradient:this.view.getCanvasTexture.bind(this.view)});const s=this.view.colorButton;s.addEventListener("blur",this._onButtonBlur),s.addEventListener("click",this._onButtonClick);this.view.addStop.addEventListener("click",this._addStop);this.view.removeStop.addEventListener("click",this._removeStop),this.view.nCycleIdx.addEventListener("click",(()=>{this._cycleStopIdx(!1)})),this.view.pCycleIdx.addEventListener("click",(()=>{this._cycleStopIdx(!0)})),this.popUpC=new Mt(t,{viewProps:this.viewProps}),this.colorPickerC=new Pt(t,{colorType:"int",value:this._curStopCol,viewProps:this.viewProps}),this.colorPickerC.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this._onPopupChildBlur),t.addEventListener("keydown",this._onPopupChildKeydown)})),this.view.element.appendChild(this.popUpC.view.element),this.popUpC.view.element.appendChild(this.colorPickerC.view.element),this.posInput=new Q(t,{baseStep:.01,sliderProps:u.fromObject({maxValue:1,minValue:0}),props:u.fromObject({draggingScale:.01,formatter:U(Z(void 0,.01))}),parser:j,value:this._curStopPos,viewProps:this.viewProps}),this.view.setPos.appendChild(this.posInput.view.element),H({primary:this._foldable.value("expanded"),secondary:this.popUpC.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue}),H({primary:this._stopIdx,secondary:this.view.stopIdx,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue}),this._stopIdx.emitter.on("change",(t=>{this._setStopIdx(t.rawValue)})),H({primary:this._curStopPos,secondary:this.posInput.value,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue}),H({primary:this._curStopPos,secondary:this.view.curStopPos,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue}),this._curStopPos.emitter.on("change",this._setStopPos),H({primary:this._curStopCol,secondary:this.colorPickerC.value,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue}),H({primary:this._curStopCol,secondary:this.view.colBtnCol,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue}),this._curStopCol.emitter.on("change",this._setStopColor),this.viewProps.handleDispose((()=>{const t=this.view.colorButton;t.removeEventListener("blur",this._onButtonBlur),t.removeEventListener("click",this._onButtonClick);this.view.addStop.addEventListener("click",this._addStop);this.view.removeStop.addEventListener("click",this._removeStop),this.colorPickerC.view.allFocusableElements.forEach((t=>{t.removeEventListener("blur",this._onPopupChildBlur),t.removeEventListener("keydown",this._onPopupChildKeydown)}))}))}_cycleStopIdx(t){(t?this._stopIdx.rawValue+1<this.value.rawValue.stops.length:this._stopIdx.rawValue-1>=0)&&this._setStopIdx(t?this._stopIdx.rawValue+1:this._stopIdx.rawValue-1)}_setStopIdx(t){this._stopIdx.setRawValue(t),this._curStopPos.setRawValue(this.value.rawValue.stops[t].stop);const e=this.value.rawValue.stops[t];this._curStopCol.setRawValue(this._gradientColToTweakCol(e.color))}_tweakColToGradientCol(t){switch(this._colorSpace){case Kt.RGB:{const e=t.getComponents("rgb","int");return{r:e[0],g:e[1],b:e[2]}}case Kt.HSV:{const e=t.getComponents("hsv","int");return{h:e[0],s:e[1],v:e[2]}}case Kt.HEX:return kt(t.getComponents("rgb","int"))}}_gradientColToTweakCol(t){switch(this._colorSpace){case Kt.RGB:{const e=t;return new ot([e.r,e.g,e.b],"rgb")}case Kt.HSV:{const e=t;return new ot([e.h,e.s,e.v],"hsv")}case Kt.HEX:{const e=function(t){const e=t.substring(1);if(6==e.length)return{r:Number.parseInt(e.substring(0,2),16),g:Number.parseInt(e.substring(2,4),16),b:Number.parseInt(e.substring(4),16)};if(3==e.length)return{r:Number.parseInt(e.substring(0,1),16),g:Number.parseInt(e.substring(1,2),16),b:Number.parseInt(e.substring(2),16)};throw new Error(`Expected hex string length of 7 or 4, but got ${t.length}`)}(t);return new ot([e.r,e.g,e.b],"rgb")}}}_addStop(){const t=[...this.value.rawValue.stops],e=t[this._stopIdx.rawValue];let s,i,n;this._stopIdx.rawValue<this.value.rawValue.stops.length-1?(i=e.stop+Math.floor((t[this._stopIdx.rawValue+1].stop-e.stop)/2*100)/100,n=this._stopIdx.rawValue+1):(i=t[this._stopIdx.rawValue-1].stop+Math.floor((e.stop-t[this._stopIdx.rawValue-1].stop)/2*100)/100,n=this._stopIdx.rawValue),s=this.view.getColorAtPoint(i),this._colorSpace==Kt.HEX?s=kt(Object.values(s)):this._colorSpace==Kt.HSV&&(s=function(t){let e,s,i,n,o;const r=t[0]>1?t[0]/255:t[0],a=t[1]>1?t[1]/255:t[1],l=t[2]>1?t[2]/255:t[2],h=Math.max(r,a,l),c=h-Math.min(r,a,l),u=t=>(h-t)/6/c+.5,d=t=>Math.round(100*t)/100;return 0==c?n=o=0:(o=c/h,e=u(r),s=u(a),i=u(l),n=r===h?i-s:a===h?1/3+e-i:2/3+s-e,n<0?n+=1:n>1&&(n-=1)),{h:Math.round(360*n),s:d(100*o),v:d(100*h)}}(Object.values(s))),t.splice(n,0,{color:s,stop:i}),this.value.setRawValue({stops:t,getGradient:this.view.getCanvasTexture.bind(this.view)}),this._stopIdx.setRawValue(n)}_removeStop(){if(this.value.rawValue.stops.length>2){const t=this._stopIdx.rawValue,e=[...this.value.rawValue.stops];e.splice(t,1),this.value.setRawValue({stops:e,getGradient:this.view.getCanvasTexture.bind(this.view)}),this._stopIdx.rawValue>=this.value.rawValue.stops.length&&this._stopIdx.setRawValue(t-1)}}_setStopPos(t){const e=[...this.value.rawValue.stops],s=e[this._stopIdx.rawValue];e[this._stopIdx.rawValue]={color:s.color,stop:t.rawValue},this.value.setRawValue({stops:e,getGradient:this.view.getCanvasTexture.bind(this.view)})}_setStopColor(t){const e=[...this.value.rawValue.stops],s=e[this._stopIdx.rawValue];e[this._stopIdx.rawValue]={color:this._tweakColToGradientCol(t.rawValue),stop:s.stop},this.value.setRawValue({stops:e,getGradient:this.view.getCanvasTexture.bind(this.view)})}_onButtonBlur(t){const e=this.view.element,s=t.relatedTarget;s&&e.contains(s)||(this.popUpC.shows.rawValue=!1)}_onButtonClick(){this._foldable.set("expanded",!this._foldable.get("expanded")),this._foldable.get("expanded")&&this.colorPickerC.view.allFocusableElements[0].focus()}_onPopupChildBlur(t){const e=this.popUpC.view.element,s=function(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}(t);s&&e.contains(s)||(s&&s===this.view.colorButton&&void 0===e.ownerDocument.ontouchstart||(this.popUpC.shows.rawValue=!1))}_onPopupChildKeydown(t){"Escape"===t.key&&(this.popUpC.shows.rawValue=!1)}}function Bt(t){return void 0!==t.stops&&t.stops.every((t=>void 0!==t.stop&&(void 0!==t.color.r&&void 0!==t.color.g&&void 0!==t.color.b||void 0!==t.color.h&&void 0!==t.color.s&&void 0!==t.color.v||"string"==typeof t.color)))}t.COLOR_SPACES=void 0,function(t){t.RGB="rgb",t.HSV="hsv",t.HEX="hex"}(t.COLOR_SPACES||(t.COLOR_SPACES={}));const $t=[{id:"gradient",type:"input",css:".tp-gradientv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-gradientv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-gradientv:hover{background-color:var(--in-bg-h)}.tp-gradientv:focus{background-color:var(--in-bg-f)}.tp-gradientv:active{background-color:var(--in-bg-a)}.tp-gradientv:disabled{opacity:.5}.tp-pop_customv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 10px #000;display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000;top:112px}.tp-pop_customv.tp-pop_customv-v{display:block;visibility:visible}.tp-gradientv{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:117px;position:relative;background-color:var(--bs-bg) !important}.tp-gradientv.tp-v-disabled{opacity:.5}.tp-gradientv_ar_cont{width:154px;height:20px;display:flex;flex-direction:row;align-items:center;justify-content:flex-start;margin-bottom:3px}.tp-gradientv_edit_stops{cursor:pointer;background-color:var(--bs-bg);width:30px;height:20px;border-radius:4px;margin-right:7px;display:flex;flex-direction:row;align-items:center;justify-content:center}.tp-gradientv_edit_stops:hover{background-color:var(--cnt-bg-h)}.tp-gradientv_edit_stops:active{background-color:var(--cnt-bg-a)}.tp-gradientv_edit_stops:focus{background-color:var(--cnt-bg-f)}.tp-gradientv_edit_stops>svg{height:15px;fill:var(--lbl-fg)}.tp-gradientv_canvas_cont{background-color:var(--cnt-bg-a);width:150px;height:20px;padding:2px;border-radius:2px;margin-bottom:14px;position:relative}.tp-gradientv_canvas_marker{width:9px;height:13px;cursor:pointer;position:absolute}.tp-gradientv_marker_top{width:0;height:0;border-style:solid;border-width:0 4.5px 4px 4.5px;border-color:rgba(0,0,0,0) rgba(0,0,0,0) var(--in-fg) rgba(0,0,0,0)}.tp-gradientv_marker_col_disp{border:1px solid var(--in-fg);width:7px;height:7px}.tp-gradientv_ctrl_cont{width:154px;height:20px;display:flex;flex-direction:row;align-items:center;justify-content:space-between;margin-bottom:7px}.tp-gradientv_cycle_idx{width:45px;height:20px;background-color:var(--cnt-bg);border-radius:4px;display:flex;align-items:center;justify-content:space-between}.tp-gradientv_cycle_idx_btn{cursor:pointer;width:7px;padding:0px 3px;height:20px;border-radius:4px;display:flex;flex-direction:column;align-items:center;justify-content:center}.tp-gradientv_cycle_idx_btn:hover{background-color:var(--cnt-bg-h)}.tp-gradientv_cycle_idx_btn:active{background-color:var(--cnt-bg-a)}.tp-gradientv_cycle_idx_btn:focus{background-color:var(--cnt-bg-f)}.tp-gradientv_cycle_idx_btn>svg{max-width:7px;fill:var(--in-fg)}.tp-gradientv_set_pos{width:98px;height:20px;border-radius:4px;display:flex;flex-direction:row;align-items:center}.tp-gradientv_set_pos_label{margin-right:3px}.tp-gradientv_col_cont{background-color:var(--cnt-bg);cursor:pointer;width:146px;height:16px;padding:4px;border-radius:4px;margin-bottom:7px;position:relative}.tp-gradientv_col_cont:hover{background-color:var(--cnt-bg-h)}.tp-gradientv_col_cont:active{background-color:var(--cnt-bg-a)}.tp-gradientv_col_cont:focus{background-color:var(--cnt-bg-f)}.tp-gradientv_stop_color_view{width:100%;height:16px;border-radius:4px}.tp-gradientv_stop_color_input{position:absolute;left:-100%;top:-100%}",accept(e,s){if(!Bt(e))return null;const i=v,n=function(t,e){const s=v.required.object(e)(t);return s.succeeded?s.value:void 0}(s,{view:i.required.constant("gradient"),colorSpace:i.optional.custom((e=>Object.values(t.COLOR_SPACES).includes(e)?e:t.COLOR_SPACES.RGB))});return n?{initialValue:e,params:n}:null},binding:{reader:t=>t=>Bt(t)?t:{stops:[{color:"#000000",stop:0},{color:"#ffffff",stop:1}],getGradient:()=>new ImageData(0,0)},writer:t=>(t,e)=>{t.write(e)}},controller:t=>new Rt(t.document,{value:t.value,viewProps:t.viewProps,colorSpace:t.params.colorSpace})}];t.plugins=$t,Object.defineProperty(t,"__esModule",{value:!0})}));
